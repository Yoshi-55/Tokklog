<% content_for :title, "Êé≤Á§∫Êùø" %>

<div class="w-full px-4 sm:px-6 max-w-7xl mx-auto">
  <% if notice.present? %>
    <div class="backdrop-blur-sm bg-emerald-500/20 border border-emerald-400/30 rounded-2xl p-4 mb-6 shadow-xl" id="notice">
              <div class="flex items-center space-x-1">
          <span class="text-pink-400 text-sm">üìä</span>
          <p class="text-pink-200 font-medium text-xs"><%= notice %></p>
      </div>
    </div>
  <% end %>

  <!-- Header Section -->
  <div class="backdrop-blur-lg bg-white/10 border border-white/20 rounded-3xl p-6 mb-8 shadow-2xl">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
      <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-gradient-to-r from-pink-400 to-rose-400 bg-clip-text">
        Êé≤Á§∫Êùø
      </h1>
      <%= link_to sake_logs_path, class: "group px-6 py-3 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-2xl font-medium shadow-lg hover:from-pink-400 hover:to-rose-400 hover:scale-105 hover:shadow-pink-500/25 transition-all duration-300" do %>
        <span class="inline-flex items-center">
          Ë®òÈå≤‰∏ÄË¶ß„Åã„ÇâÊñ∞Ë¶èÊäïÁ®ø
          <svg class="w-5 h-5 ml-2 group-hover:rotate-90 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
        </span>
      <% end %>
    </div>

    <!-- Ê§úÁ¥¢„Éï„Ç©„Éº„É† -->
    <div class="mt-6 flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
      <!-- „Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢ -->
      <%= form_with url: posts_path, method: :get, local: true, class: "flex items-center gap-2 max-w-md" do |f| %>
        <%= f.text_field :q, value: params[:q], placeholder: "„Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢", 
            class: "flex-1 rounded-2xl border border-white/20 bg-white/10 backdrop-blur-sm text-white px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 placeholder-gray-300" %>
        <%= f.submit "Ê§úÁ¥¢", class: "rounded-2xl px-6 py-3 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-400 hover:to-rose-400 text-white font-medium text-sm transition-all duration-200 hover:scale-105" %>
        <% if params[:q].present? %>
          <%= link_to '„ÇØ„É™„Ç¢', posts_path, class: 'rounded-2xl px-4 py-3 backdrop-blur-sm bg-white/10 border border-white/20 hover:bg-white/20 text-gray-200 hover:text-white text-sm font-medium transition-all duration-200' %>
        <% end %>
      <% end %>

      <!-- Âë≥Ë¶ö„Å´„Çà„Çã‰∏¶„Å≥Êõø„Åà -->
      <%= form_with url: posts_path, method: :get, local: true, class: "flex flex-wrap items-center gap-2" do |f| %>
        <%= f.hidden_field :q, value: params[:q] %>
        
        <!-- Âë≥Ë¶öÈÅ∏Êäû -->
        <%= f.select :taste_sort, 
            options_for_select([
              ['ÁîòÂë≥', 'sweetness'],
              ['ÈÖ∏Âë≥', 'sourness'], 
              ['Ëã¶Âë≥', 'bitterness'],
              ['Êó®Âë≥', 'umami'],
              ['ËæõÂë≥', 'spiciness']
            ], params[:taste_sort]),
            { prompt: 'Âë≥Ë¶öÈÅ∏Êäû' },
            { class: "rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-pink-400" } %>
        
        <!-- ‰∏¶„Å≥È†ÜÈÅ∏Êäû -->
        <%= f.select :taste_direction,
            options_for_select([
              ['ÈôçÈ†Ü', 'desc'],
              ['ÊòáÈ†Ü', 'asc']
            ], params[:taste_direction] || 'desc'),
            { prompt: 'È†ÜÂ∫è' },
            { class: "rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-pink-400" } %>
        
        <!-- ÈÅ©Áî®„Éú„Çø„É≥ -->
        <%= f.submit "ÈÅ©Áî®", class: "rounded-lg px-3 py-1 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-400 hover:to-rose-400 text-white font-medium text-xs transition-all duration-200" %>
        
        <!-- „É™„Çª„ÉÉ„Éà„Éú„Çø„É≥ -->
        <% if params[:taste_sort].present? || params[:taste_direction].present? %>
          <%= link_to '„É™„Çª„ÉÉ„Éà', posts_path(q: params[:q]), class: 'rounded-lg px-3 py-1 backdrop-blur-sm bg-white/10 border border-white/20 hover:bg-white/20 text-gray-200 hover:text-white text-xs font-medium transition-all duration-200' %>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- ÊäïÁ®ø‰∏ÄË¶ß -->
  <% if @posts.any? %>
    <!-- ÁèæÂú®„ÅÆ‰∏¶„Å≥Êõø„ÅàÁä∂ÊÖãË°®Á§∫ -->
    <% if params[:taste_sort].present? && params[:taste_direction].present? %>
      <div class="backdrop-blur-sm bg-pink-500/15 border border-pink-400/25 rounded-xl p-2 mb-4">
        <div class="flex items-center space-x-1">
                  <span class="text-pink-300 text-xs font-medium">üìä Âë≥Ë¶ö„Åß‰∏¶„Å≥Êõø„Åà:</span>
          <p class="text-pink-200 font-medium text-xs">
            <% taste_names = { 'sweetness' => 'ÁîòÂë≥', 'sourness' => 'ÈÖ∏Âë≥', 'bitterness' => 'Ëã¶Âë≥', 'umami' => 'Êó®Âë≥', 'spiciness' => 'ËæõÂë≥' } %>
            <% direction_names = { 'desc' => 'ÈôçÈ†Ü', 'asc' => 'ÊòáÈ†Ü' } %>
            <strong><%= taste_names[params[:taste_sort]] %></strong><strong><%= direction_names[params[:taste_direction]] %></strong>„Åß‰∏¶„Å≥Êõø„Åà‰∏≠
          </p>
        </div>
      </div>
    <% end %>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 auto-rows-fr">
      <% @posts.each do |post| %>
        <div class="group backdrop-blur-lg bg-white/10 border border-white/20 rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105 hover:bg-white/15 overflow-hidden flex flex-col h-full">
          <div class="p-6 flex-1 flex flex-col">
            <div class="flex-1">
              <div class="space-y-4 text-white">
                <%# ÊäïÁ®øËÄÖÊÉÖÂ†± %>
                <div class="pb-2 border-b border-white/10">
                  <div class="flex items-center gap-2">
                    <div class="w-6 h-6 rounded-full bg-gradient-to-r from-pink-400 to-yellow-300 flex items-center justify-center text-xs text-white font-bold">
                      <%= (post.user.name.presence || 'U').first %>
                    </div>
                    <div class="text-xs">
                      <div class="font-medium text-yellow-300"><%= post.user.name if post.user %></div>
                      <div class="text-gray-400"><%= l(post.created_at, format: :short) %></div>
                    </div>
                    <div class="ml-auto flex items-center">
                      <%= form_with url: post_likes_path(post), method: :post, local: false, data: { remote: false }, class: "inline-block" do %>
                        <% if user_signed_in? %>
                          <% if post.likes.exists?(user: current_user) %>
                            <button type="submit" class="bg-transparent border-none text-pink-400 text-xl mr-1" title="„ÅÑ„ÅÑ„Å≠Ëß£Èô§">‚ô•</button>
                          <% else %>
                            <button type="submit" class="bg-transparent border-none text-gray-400 text-xl hover:text-pink-400 mr-1" title="„ÅÑ„ÅÑ„Å≠">‚ô•</button>
                          <% end %>
                        <% else %>
                          <span class="text-gray-300 text-xl mr-1">‚ô•</span>
                        <% end %>
                        <span class="text-yellow-300 font-bold text-xs like-count"><%= post.likes.count %></span>
                      <% end %>
                    </div>
                  </div>
                </div>

                <%# ÈäòÊüÑ %>
                <div class="space-y-2">
                  <div class="flex items-center space-x-2">
                    <span class="text-yellow-400 text-lg">üç∂</span>
                    <strong class="text-yellow-200 font-semibold text-sm tracking-wide">ÈäòÊüÑ</strong>
                  </div>
                  <div class="text-white font-bold text-lg leading-tight">
                    <%= post.brand %>
                  </div>
                </div>

                <%# „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà %>
                <% if post.has_radar_data? %>
                <div class="space-y-3">
                  <div class="flex items-center space-x-2">
                    <span class="text-green-400 text-lg">üìä</span>
                    <strong class="text-green-200 font-semibold text-sm tracking-wide">Âë≥Ë¶öË©ï‰æ°</strong>
                  </div>
                  <div class="relative h-48 w-full bg-gradient-to-br from-slate-800/40 to-slate-700/30 rounded-xl border border-slate-600/30 p-4 shadow-inner">
                    <canvas id="radar-<%= post.id %>" 
                            class="radar-chart w-full h-full" 
                            data-chart-data="<%= post.radar_values.to_json %>">
                    </canvas>
                  </div>
                </div>
                <% end %>

                <%# „É°„É¢ %>
                <div class="space-y-2">
                  <div class="flex items-center space-x-2">
                    <span class="text-emerald-400 text-lg">üìù</span>
                    <strong class="text-emerald-200 font-semibold text-sm tracking-wide">„É°„É¢</strong>
                  </div>
                  <div class="text-gray-300 text-sm leading-relaxed line-clamp-3">
                    <%= post.memo %>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
          <div class="p-4 border-t border-white/10 flex gap-3 mt-auto">
            <%= link_to post_path(post), class: "flex-1 text-center py-3 px-4 backdrop-blur-sm bg-white/10 border border-white/20 text-gray-200 rounded-xl font-medium text-sm hover:bg-white/20 hover:text-white transition-all duration-200" do %>
              <span class="inline-flex items-center">
                Ë©≥Á¥∞
              </span>
            <% end %>
            <% if user_signed_in? && post.user == current_user %>
              <%= link_to post_path(post), method: :delete, 
                  data: { confirm: "Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" },
                  class: "flex-1 text-center py-3 px-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-medium text-sm hover:from-red-400 hover:to-red-500 hover:scale-105 transition-all duration-200" do %>
                <span class="inline-flex items-center">
                  ÂâäÈô§
                </span>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
    <div class="flex justify-center my-8">
      <%= paginate @posts %>
    </div>
  <% else %>
    <div class="text-center py-20">
      <div class="backdrop-blur-lg bg-white/5 border border-white/10 rounded-3xl p-12 max-w-md mx-auto">
        <div class="text-6xl mb-4 text-gray-400">‚óã</div>
        <p class="text-xl text-gray-300 mb-4">„Åæ„Å†ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
        <p class="text-gray-400 mb-6">ÊúÄÂàù„ÅÆÊäïÁ®ø„Çí‰ΩúÊàê„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>
        <%= link_to sake_logs_path, class: "inline-flex items-center px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-2xl font-medium hover:from-yellow-400 hover:to-orange-400 hover:scale-105 transition-all duration-300" do %>
          Ë®òÈå≤„Åã„ÇâÊäïÁ®ø„Çí‰ΩúÊàê
        <% end %>
      </div>
    </div>
  <% end %>
</div>
</div>
